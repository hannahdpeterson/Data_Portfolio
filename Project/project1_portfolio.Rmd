---
title: "Uber Rideshare Data"
author: "Hannah Peterson"
date: "2025-09-01"
output: html_document
---

### Overview of Data

This data set contains data via Uber ride transactions in order to evaluate for any patterns of concern when it comes to ride-share cancellations, and can be utilized for various analysis of topics such as frequented locations for pick up and drop off, how Uber ride ratings can be related/effected by ride duration time, vehicle type, payment methods, etc.

#### Looking into the data

```{r, include=FALSE}
library(readr)
library(tidyverse)
source <- "~//rides.csv"
# new_source <- "/Users/hannahpeterson/Data_Portfolio/Project/rides.csv"
# file.rename(from = source, to = new_source)
```

The CSV file, titled "rides.csv" contains the data we will work with.

```{r}
# titling our data an easier, accessible title
rides <- read.csv(".//rides.csv")

head(rides) # top 6 rows
```

### Cleaning Up the Data

I'd first like to rid of unnecessary data or clutter. I am going to read and select specific columns to decide whether they are necessary for our exploration and follow up with a rename/reorganization of the remaining data.

As of immediate understanding of the data, both "Booking.ID" "Customer.ID" are unnecessary for a broad view of our data, as these are personal and case-by-case identifiers. Before removing them, however, I will make sure there are no duplicate rows.

```{r}
sum(duplicated(rides))
# There are no duplicate rows so I will remove both identifying variables
rides <- rides |> select(-Booking.ID, -Customer.ID)
```

Now lets separate the data by cancelled rides by customer, cancelled rides by driver, incomplete rides, no driver found, and completed rides.

```{r}
complete <- rides |> filter(Booking.Status == "Completed")
```

### Exploratory Data Analysis (EDA)

Before creating any models, I would first like to explore how differing variables interact with outcomes in this set. For simplicity, I want to look at which variables in our complete data set have a statistically significant interaction with ride scores and their effect on them overall. For an extension of exploration, I want to see how variables in each set interact with cancelled outcomes, as in, how can distance, location, time to pickup, trip duration, fare, payment methods or time of day correlate with rides being cancelled by drivers or riders. For the no driver or incomplete rides, there are not enough variables to explore an association and an outcome with so we will ignore those sets.

#### Complete Rides - Customer Ratings vs. Booking Value, Driver Arrival Time, Trip Duration, and Ride Distance

Starting with the "complete" data set, we know we want to see how each variable interacts with customer rating or "Customer.Rating". Lets see if there is a visual correlation with any of these variables. Specifically, I want to evaluate

```{r}
# after first attempt I recognize variables are in character class so I am changing to numeric first
complete$Booking.Value <- as.numeric(complete$Booking.Value)
complete$Customer.Rating <- as.numeric(complete$Customer.Rating)
complete$Avg.VTAT <- as.numeric(complete$Avg.VTAT)
complete$Avg.CTAT <- as.numeric(complete$Avg.CTAT)
complete$Ride.Distance <- as.numeric(complete$Ride.Distance)


# correlation with numeric variables
cor.test(complete$Booking.Value, complete$Customer.Rating) # Booking Value
cor.test(complete$Avg.VTAT, complete$Customer.Rating) # Average time for driver to reach pickup location
cor.test(complete$Avg.CTAT, complete$Customer.Rating) # Average trip duration
cor.test(complete$Ride.Distance, complete$Customer.Rating) # Ride distance in km

```

Looking at a general correlation for each value alongside the customer rating, these correlations display little linearity to customer rating impact and with an alpha level set at 0.05, we are failing to reject the null. However, for the sake of exploring, lets do a regression model just to see how these variables interact with customer rating together:\

```{r}
complete_2 <- complete |> select(Customer.Rating, Booking.Value, Avg.VTAT, Avg.CTAT, 
                               Ride.Distance)

model_complete <- lm(Customer.Rating ~ Booking.Value + Avg.VTAT + Avg.CTAT + Ride.Distance,
            data = complete_2) # fitting model

# clean output
library(broom)
library(car)
tidy(model_complete) |>
  mutate(Significant = if_else(p.value < 0.05, "Significant", "Not Significant"))

vif(model_complete) # Always check multicollinearity for safety
```

Based on both our correlation test and the regression model, there seems to be no statistically significant impact of any of the four variables for completed rides that impact a customers rating. We also tested for multicollinearity and found that it is not effecting my model, therefor the results found from the regression model are accurate.

#### Complete Rides - Customer Ratings vs. Vehicle Type, Pickup Location, Drop Off Location, Payment Method

Given these variables are categorical, an ANOVA test to check for significant impact on our customer ratings would be the best course of action. Requirements to run ANOVA include exclusion of outliers, homogeneity, and normality. Lets check for all three.

```{r}
library(ggplot2) # boxplots will display normality and outliers
ggplot(complete, aes(x= Vehicle.Type, y = Customer.Rating)) + geom_boxplot()
ggplot(complete, aes(x= Pickup.Location, y = Customer.Rating)) + geom_boxplot()
ggplot(complete, aes(x= Drop.Location, y = Customer.Rating)) + geom_boxplot()
ggplot(complete, aes(x= Payment.Method, y = Customer.Rating)) + geom_boxplot()
```

Each of our variables have outliers, which defies the requirements for an ANVOA test. Given this, a Kruskal-Wallis test would better fit our data since ANOVA assumptions were violated.

```{r}
kruskal.test(Customer.Rating ~ Vehicle.Type, data = complete)
kruskal.test(Customer.Rating ~ Pickup.Location, data = complete)
kruskal.test(Customer.Rating ~ Drop.Location, data = complete)
kruskal.test(Customer.Rating ~ Payment.Method, data = complete)
```

We again are seeing no statistically significant impact on customer ratings on given variables. Overall with this data set exploration, we can conclude that customers ratings are independent of both numeric and categorical variables recorded in this data set.

#### All Rides - Cancelled/Completed vs. Average Driver Arrival Time

We will now explore the relationship between booking status (cancelled and completed rides) in association with the drivers average arrival time. The reason we are only using this variable is because this predictor is the only one that is numeric and recorded regardless of whether the ride is cancelled or not. I am also interested to see if a longer driver arrival time may impact whether or not the ride is cancelled. We will use multinomial logistics to explore this because we have a dependent variable with three levels and a numeric predictor. This is best suited for multinomial logistics regression modeling:

```{r}
library(nnet)
# there is "incomplete" and "No Driver Found" which do not need to be included as they add no further value to the alternative variables. I am filtering them out.
all_rides <- rides |>
  filter(Booking.Status %in% c("Cancelled by Driver", 
                               "Cancelled by Customer",
                               "Completed")) |> select(Avg.VTAT, 
                                                       Booking.Status)
# checking numeric variables and making sure booking status is a factor
all_rides <- all_rides |>
  mutate(
    Avg.VTAT = as.numeric(Avg.VTAT),
    Booking.Status = as.factor(Booking.Status) # factor since its our dependent
  )
# releveling
all_rides$Booking.Status <- relevel(all_rides$Booking.Status, ref = "Completed")

# now we can conduct multinomial logistics
ml_model <- multinom(Booking.Status ~ Avg.VTAT, data = all_rides)
summary(ml_model)

# computing p-values because multinom doesn't do automatically
z <- summary(ml_model)$coefficients / summary(ml_model)$standard.errors
p_values <- 2 * (1 - pnorm(abs(z)))

p_values
```

"Completed" was chosen as our baseline for our multinomial regression model in order to view how cancellations by customers and drivers compare to completed rides. We received a p-value derived from our model indicating that our findings are statistically significant. For our "Cancelled by Customer" coefficient, we received a 0.305 (log-odds) which means that as the drivers average arrival time increased, the customers are more likely to cancel compared to a completed ride. For our "Cancelled by Driver" coefficient, a -0.079 (log-odds) was found which indicates that as drivers average arrival time increased, drivers are less likely to cancel compared to a completed ride.

What this means in summary is that as the wait times get longer, a customer is more likely to cancel but a driver is not.

#### Visualization:

```{r}
library(ggplot2)

ggplot(all_rides, aes(x = Booking.Status, y = Avg.VTAT, fill = Booking.Status)) +
  geom_boxplot() +
  labs(title = "Driver Arrival Time vs. Booking Outcome",
       x = "Booking Outcome",
       y = "Average Driver Arrival Time") +
  theme_classic()

```

The graph visualization adds value to the data, as we can see there seems to be a "safe zone" for completed rides. When average driver arrival time is not too long, customers do not cancel, and when driver arrival times are not early, the drivers do not cancel. Looking at the boxplot, I can see that drivers seem to cancel more often when there arrival time is predicted to be sooner, which opens questions to whether drivers are cancelling rides that are nearby because they are providing less payment, perhaps, for that ride given its distance. Customer cancellations have an obvious correlation with higher driver arrival times, likely reflecting impatience from riders. Completed rides have a middle ground between the two, but no where near as high for average arrival time as the ones cancelled by customers.

### Conclusion

Following our exploration, I have a few asks of future studies. I believe that it would be valuable to include what the original cost of the ride was for rides regardless of cancellation, as in this study they replaced any cancelled ride with "null" in the Booking.Value category, which was a category that recorded the price of the ride. I feel this could have shown value in if the payment is reflecting distance appropriately, and may be a driving reason for driver cancellations. If drivers are feeling they are being under payed, compensating correctly may influence less driver cancellations which could benefit Uber in the long run given more accessible rides and happier customer base. However, we were able to find that correlation between average driver arrival time and driver and customer cancellation.
